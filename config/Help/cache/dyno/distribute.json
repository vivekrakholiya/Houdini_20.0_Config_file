{"type": "root", "attrs": {}, "body": [{"level": 0, "type": "title", "indent": 0, "text": ["Distributing simulations"], "extent": [0, 29]}, {"type": "summary", "indent": 0, "text": ["Distribute shelf tools set up an object\u2019s sim network so it can be solved in parallel on a farm of multiple machines using HQueue."], "extent": [29, 168]}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Overview"], "extent": [168, 183], "body": [{"type": "para", "indent": 0, "text": ["Houdini allows you to set up the networks of a simulated object so that it can be solved in parallel on multiple machines using ", {"scheme": null, "value": "../hqueue", "type": "link", "text": ["HQueue"], "fullpath": "/hqueue.html"}, ". HQueue is a render and simulation job management system, consisting of a HQueue Server, HQueue Clients, workstations, and a Shared Folder. "], "extent": [183, 473]}, {"type": "bullet_group", "body": [{"blevel": 2, "type": "bullet", "indent": 0, "text": ["The server is responsible for distributing your task to different client machines. The server also provides a web interface, where you can monitor and manage your jobs. The server is normally installed on a single computer."], "extent": [473, 699]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["A client receives jobs from the servers and performs the incoming simulation and render tasks. Sometimes, clients are also called ", {"type": "em", "text": ["nodes"]}, ". The machine with the server running can also be configured as client. The client must be installed on every computer you want to use for a job."], "extent": [699, 984]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["Users, working in Houdini, submit jobs from a workstation to the HQueue Server which are then distributed to the HQueue Clients."], "extent": [984, 1115]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["The Shared Folder is mounted as a shared drive on the network. Workstations transfer input files to the folder to make them accessible for the HQueue Clients. The HQueue Clients, on the other hand, write output files to the Shared Folder. The workstations are then able to read the output files."], "extent": [1115, 1414]}], "container": true}]}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Before you begin"], "extent": [1414, 1437], "body": [{"type": "para", "indent": 0, "text": ["Before you can start distributing simulation jobs, you have to install the HQueue Server and Clients. To do this, download the Houdini installer from the SideFX website and execute it. Note that you normally need administrator privileges to install the software. Specify, which computer you want to use as "], "extent": [1437, 1746]}, {"type": "bullet_group", "body": [{"blevel": 2, "type": "bullet", "indent": 0, "text": ["HQueue Server. The HQueue Server must be installed on ", {"type": "em", "text": ["one"]}, " machine only."], "extent": [1746, 1822]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["HQueue Client. The HQueue Client must be installed on ", {"type": "em", "text": ["all"]}, " machines that should contribute to the job."], "extent": [1822, 1928]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["Shared Folder. The Shared Folder is defined in the HQueue Server\u2019s web interface. Make sure that all machines have appropriate privileges to access this folder."], "extent": [1928, 2092]}], "container": true}, {"type": "note_group", "body": [{"type": "note", "indent": 0, "role": "item", "extent": [2092, 2098], "body": [{"type": "para", "indent": 4, "text": ["Please read through the ", {"scheme": null, "value": "../hqueue", "type": "link", "text": ["HQueue documentation"], "fullpath": "/hqueue.html"}, " for detailed information on topics like installation, OS-specific settings or IP addresses. This guide helps you through the entire process of setting up your own farm."], "extent": [2098, 2329]}], "container": true}], "container": true, "role": "item_group"}]}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Read me"], "extent": [2329, 2343], "body": [{"type": "para", "indent": 0, "text": ["Most of Houdini\u2019s simulation networks can also be created inside SOPs, e.g. Vellum, fluids or Rigid Body Dynamics. However, distributed simulations are currently only possible with DOP-based workflows. To be more precise: it\u2019s possible to send a SOP-based simulation job to a single HQueue Client, but you can\u2019t distribute the job over several machines."], "extent": [2343, 2699]}, {"type": "dt_group", "body": [{"type": "dt", "indent": 0, "text": ["For DOP-based networks, there\u2019s also one important limitation"], "extent": [2699, 2763], "body": [{"type": "bullet_group", "body": [{"blevel": 6, "type": "bullet", "indent": 4, "text": ["Houdini\u2019s ", {"scheme": "Shelf", "value": "pyrofx", "type": "link", "text": ["Pyro FX shelf tools"], "fullpath": "/dyno/pyrofx.html"}, " are based on the ", {"scheme": "Node", "value": "/nodes/dop/pyrosolver_sparse", "type": "link", "text": ["Pyro Solver (Sparse)"], "fullpath": "/nodes/dop/pyrosolver_sparse.html"}, " and don\u2019t support distributed simulations by default. If you want to distribute a simulation, you must manually replace the sparse solver through the standard dense ", {"scheme": "Node", "value": "/nodes/dop/pyrosolver", "type": "link", "text": ["Pyro Solver DOP"], "fullpath": "/nodes/dop/pyrosolver.html"}, "."], "extent": [2763, 3086]}], "container": true}], "container": true}], "container": true}, {"type": "para", "indent": 0, "text": ["You can distribute POP particles, non-adaptive particle fluids and dense pyro simulations using ", {"type": "em", "text": ["slicing"]}, ". There, the space in which the effect happens is partitioned and each slice is solved on a separate machine. You can slice grid-based fluid containers using a certain number of divisions per side, but for particle fluids simulations that ", {"type": "em", "text": ["do not"]}, " have boundaries, you have to ", {"scheme": null, "value": "#slicing", "type": "link", "text": ["slice them manually"], "fullpath": "/dyno/distribute.html#slicing", "fragment": "#slicing"}, ". For sliced simulations, the nodes on the network talk to each other to communicate information across the boundaries between slices."], "extent": [3086, 3634]}, {"type": "para", "indent": 0, "text": ["Dense pyro simulations, on the other hand, can also be clustered through a ", {"scheme": "Node", "value": "/nodes/sop/cluster", "type": "link", "text": ["Cluster SOP"], "fullpath": "/nodes/sop/cluster.html"}, " to subdivide the pyro source particles into segments. Each cluster container solves independently, even if they overlap with other cluster containers. For smoke and pyro simulations this works well since their output volumes blend together visually."], "extent": [3634, 3991]}]}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Distribution setup"], "extent": [3991, 4016], "body": [{"type": "para", "indent": 0, "text": ["Particle fluids are certainly the most interesting solver type for distributed simulations, because they often require long simulation times. To ease the task of preparing a project for distributed simulations, you can use various shelf tools. They're all located under the ", {"scheme": "Shelf", "value": "particle-fluids", "type": "link", "text": ["Particle Fluids shelf tool"], "fullpath": "/dyno/particle-fluids.html"}, "."], "extent": [4016, 4344]}, {"type": "ord_group", "body": [{"blevel": 2, "type": "ord", "indent": 0, "text": ["Open the ", {"type": "ui", "text": ["Particle Fluids"]}, " shelf tab."], "extent": [4344, 4386]}, {"blevel": 2, "type": "ord", "indent": 0, "text": [{"keys": ["Ctrl"], "type": "keys", "text": null}, " click the ", {"scheme": "Smallicon", "value": "SHELF/fliptank.svg", "type": "link", "text": "", "fullpath": "/dyno/SHELF/fliptank.svg.html"}, " ", {"scheme": "Shelf", "value": "flip-tank", "type": "link", "text": ["FLIP Tank"], "fullpath": "/dyno/flip-tank.html"}, " shelf tool to add the tank at the scene\u2019s origin."], "extent": [4386, 4516]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["From the same shelf, click the ", {"scheme": "Smallicon", "value": "SHELF/distribution.svg", "type": "link", "text": "", "fullpath": "/dyno/SHELF/distribution.svg.html"}, " ", {"scheme": null, "value": "shelf:distribute", "type": "link", "text": ["Distribute Particle Fluid"], "exists": true}, " shelf tool."], "extent": [4516, 4641]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["You must select a particle fluid to run the tool. From the viewport\u2019s left icon bar, choose the ", {"scheme": "Smallicon", "value": "COMMON/select.svg", "type": "link", "text": "", "fullpath": "/dyno/COMMON/select.svg.html"}, " ", {"type": "ui", "text": ["Select"]}, " tool and draw a rectangle around the fluid in the viewport. Then, press ", {"keys": ["Enter"], "type": "keys", "text": null}, " to confirm your selection."], "extent": [4641, 4889]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Houdini jumps into the ", {"type": "em", "text": ["out"]}, " network you can see a ", {"type": "code", "text": ["distributedsim_fliptank"]}, " node. This node submits the job to the HQueue for distribution on the farm."], "extent": [4889, 5044]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["In the ", {"type": "ui", "text": ["Output Driver"]}, " you can see a path. If you have followed the steps above, the path is ", {"type": "code", "text": ["/obj/distribute_fliptank"]}, ", while ", {"type": "code", "text": ["save"]}, " is the node you're referencing to."], "extent": [5044, 5217]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Open the path in the Network Editor. The ", {"type": "code", "text": ["save"]}, " object is a ", {"scheme": "Node", "value": "/nodes/out/geometry", "type": "link", "text": ["Geometry Output ROP"], "fullpath": "/nodes/out/geometry.html"}, " and performs the simulation by clicking ", {"type": "ui", "text": ["Save to Disk"]}, "."], "extent": [5217, 5378]}], "container": true}]}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Methods of distributing simulations"], "extent": [5378, 5420], "body": [{"type": "para", "indent": 0, "text": ["You can select the distribution method you want to use from the ", {"type": "ui", "text": ["Partitioning Type"]}, " drop-down menu located in the ", {"type": "code", "text": ["distributedsim_fliptank"]}, " ", {"scheme": "Node", "value": "/nodes/out/hq_sim", "type": "link", "text": ["HQueue Simulation render node"], "fullpath": "/nodes/out/hq_sim.html"}, " parameters."], "extent": [5420, 5624]}, {"type": "dt_group", "body": [{"type": "dt", "indent": 0, "text": ["No partitioning"], "extent": [5624, 5641], "body": [{"type": "para", "indent": 3, "text": ["Sends the entire simulation to another machine to be simulated as a whole."], "extent": [5641, 5720]}], "container": true}, {"type": "dt", "indent": 0, "text": ["Clustering"], "extent": [5720, 5732], "body": [{"type": "para", "indent": 3, "text": ["Allows you to partition the source into chunks along the X, Y, or Z axis. These pieces are simulated simultaneously, but they ", {"type": "em", "text": ["do not"]}, " talk to each other or transfer particles between frames. Since clustering doesn\u2019t need to wait for each partition to finish simulating a frame before moving onto the next, this method is much faster than slicing. "], "extent": [5732, 6097]}], "container": true}, {"type": "dt", "indent": 0, "text": ["Slicing"], "extent": [6097, 6106], "body": [{"type": "para", "indent": 3, "text": ["Allows you to slice the space containing a particle fluid so that different machines on an HQueue farm can simulate different parts of the fluid. Since this method transfers particles between slices at the end of each frame, it is more precise (but also more expensive) than clustering."], "extent": [6106, 6397]}, {"type": "tip_group", "body": [{"type": "tip", "indent": 3, "role": "item", "extent": [6397, 6405], "body": [{"type": "para", "indent": 5, "text": ["For more control over the direction and hierarchy of your pieces, use the ", {"scheme": "Icon", "value": "DOP/sliceplane", "type": "link", "text": "", "fullpath": "/dyno/DOP/sliceplane.html"}, " ", {"scheme": null, "value": "/shelf/slice", "type": "link", "text": ["Slice"], "fullpath": "/shelf/slice.html"}, " or ", {"scheme": "Icon", "value": "DOP/slicealongline", "type": "link", "text": "", "fullpath": "/dyno/DOP/slicealongline.html"}, " ", {"scheme": null, "value": "/shelf/slicealongline", "type": "link", "text": ["Slice Along Line"], "fullpath": "/shelf/slicealongline.html"}, " shelf tool."], "extent": [6405, 6610]}, {"type": "para", "indent": 5, "text": ["For more information, see ", {"scheme": null, "value": "#slicing", "type": "link", "text": ["Set up a sliced distributed simulation"], "fullpath": "/dyno/distribute.html#slicing", "fragment": "#slicing"}, " down below."], "extent": [6610, 6704]}], "container": true}], "container": true, "role": "item_group"}, {"type": "dt_group", "body": [{"type": "dt", "indent": 3, "text": ["Volume slicing"], "extent": [6704, 6723], "body": [{"type": "para", "indent": 5, "text": ["Automatically slices a space containing a particle fluid into equal NxMxP pieces. You can also specify a specific overlap to provide a buffer around each piece. The separate machines will then work on each slice, and periodically synchronize their buffers. This works well for ", {"type": "em", "text": ["dense"]}, " sims in fixed rectangular spaces like pyro solves. "], "extent": [6723, 7066]}], "container": true}, {"type": "dt", "indent": 3, "text": ["Particle slicing"], "extent": [7066, 7087], "body": [{"type": "para", "indent": 5, "text": ["For ", {"type": "em", "text": ["non-dense"]}, " simulations, splitting the domain into equal parts doesn\u2019t make sense. It is important that the partition be balanced so that one machine isn\u2019t waiting for the other machines to finish. So instead you will want to divide your sim space using the ", {"type": "strong", "text": ["Slice"]}, " or ", {"type": "strong", "text": ["Slice Plane"]}, " DOP nodes. These divide the world into different regions that each simulation machine then ", {"type": "em", "text": ["owns"]}, ". Each machine has all the data for its own slice and some boundary information for the surrounding slices to avoid having to constantly update."], "extent": [7087, 7622]}], "container": true}], "container": true}], "container": true}, {"type": "dt", "indent": 0, "text": ["Wedging"], "extent": [7622, 7631], "body": [{"type": "para", "indent": 3, "text": ["Allows you to try different variations of a simulation. For more information, see the ", {"scheme": "Icon", "value": "SHELF/factory.svg", "type": "link", "text": "", "fullpath": "/dyno/SHELF/factory.svg.html"}, " ", {"scheme": null, "value": "/nodes/out/hq_sim", "type": "link", "text": ["HQueue Simulation render node"], "fullpath": "/nodes/out/hq_sim.html"}, " and ", {"scheme": "Icon", "value": "ROP/wedge.svg", "type": "link", "text": "", "fullpath": "/dyno/ROP/wedge.svg.html"}, " ", {"scheme": null, "value": "/nodes/out/wedge", "type": "link", "text": ["Wedge render node"], "fullpath": "/nodes/out/wedge.html"}, "."], "extent": [7631, 7859]}], "container": true}], "container": true}]}, {"level": 2, "id": "slicing", "container": true, "type": "h", "indent": 0, "text": ["Set up a sliced distributed simulation"], "extent": [7859, 7914], "body": [{"type": "para", "indent": 0, "text": ["Slicing the space containing a particle fluid allows different machines on the HQueue farm to simulate different ", {"type": "em", "text": ["regions"]}, " of the fluid. You can send a particle fluid simulation to the farm without slicing, but it will just simulate on one machine instead of multiple machines in parallel."], "extent": [7914, 8206]}, {"type": "para", "indent": 0, "text": ["There are two shelf tools on the ", {"type": "ui", "text": ["Particle Fluids"]}, " tab for slicing a particle fluid simulation into separate regions for distribution:"], "extent": [8206, 8344]}, {"type": "bullet_group", "body": [{"blevel": 2, "type": "bullet", "indent": 0, "text": [{"scheme": "Icon", "value": "DOP/slicealongline", "type": "link", "text": "", "fullpath": "/dyno/DOP/slicealongline.html"}, {"scheme": null, "value": "/shelf/slicealongline", "type": "link", "text": ["Slice along line"], "fullpath": "/shelf/slicealongline.html"}, " tool"], "extent": [8344, 8418], "body": [{"type": "para", "indent": 3, "text": ["Creates a specified number of equally spaced slices along a certain direction. This is the simplest way to slice up space."], "extent": [8418, 8545]}, {"type": "para", "indent": 3, "text": [{"scheme": "Image", "value": "/images/shelf/slicealongline.jpg", "type": "img", "text": ""}], "extent": [8545, 8590]}], "container": true}, {"blevel": 2, "type": "bullet", "indent": 0, "text": [{"scheme": "Icon", "value": "DOP/sliceplane", "type": "link", "text": "", "fullpath": "/dyno/DOP/sliceplane.html"}, {"scheme": null, "value": "/shelf/slice", "type": "link", "text": ["Slice"], "fullpath": "/shelf/slice.html"}, " tool"], "extent": [8590, 8640], "body": [{"type": "para", "indent": 3, "text": ["Slices the space using a hierarchy of intersecting planes which arbitrarily divides the space in complex ways."], "extent": [8640, 8755]}, {"type": "para", "indent": 3, "text": [{"scheme": "Image", "value": "/images/shelf/slice.jpg", "type": "img", "text": ""}], "extent": [8755, 8791]}], "container": true}], "container": true}, {"type": "para", "indent": 0, "text": ["Each fluid region requires an individual machine on the HQueue client network, so you can only set up as many regions as you have machines. For example, using the ", {"type": "ui", "text": ["Slice along line"]}, " tool with ", {"type": "ui", "text": ["Number of regions"]}, " set to ", {"type": "code", "text": ["8"]}, " would require 8 machines on the HQueue network."], "extent": [8791, 9067]}, {"level": 3, "id": "slicefluid", "container": true, "type": "h", "indent": 0, "text": ["How to slice a fluid space"], "extent": [9067, 9115], "body": [{"type": "ord_group", "body": [{"blevel": 2, "type": "ord", "indent": 0, "text": ["On the ", {"type": "ui", "text": ["Particle Fluids"]}, ", ", {"type": "ui", "text": ["Cloth"]}, ", or ", {"type": "ui", "text": ["Wire"]}, " shelf tab, click the ", {"scheme": "Icon", "value": "SHELF/distribute_fluid_sim", "type": "link", "text": "", "fullpath": "/dyno/SHELF/distribute_fluid_sim.html"}, " ", {"type": "ui", "text": ["Distribute"]}, " tool."], "extent": [9115, 9246]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Select the particle fluid, cloth, or wire object and press ", {"keys": ["Enter"], "type": "keys", "text": null}, "."], "extent": [9246, 9319], "body": [{"type": "para", "indent": 4, "text": ["This creates a few nodes in various networks for distributing the simulation:"], "extent": [9319, 9406]}, {"type": "bullet_group", "body": [{"blevel": 6, "type": "bullet", "indent": 4, "text": ["A ", {"type": "code", "text": ["distributedsim"]}, " HQueue Simulation render node in ", {"type": "code", "text": ["/out"]}, " to render the simulation out to HQueue."], "extent": [9406, 9516], "body": [{"type": "para", "indent": 8, "text": ["This render node sends the distribution job to the HQueue server."], "extent": [9516, 9595]}], "container": true}, {"blevel": 6, "type": "bullet", "indent": 4, "text": ["A ", {"type": "code", "text": ["distribute_", {"type": "var", "text": ["objectname"]}]}, " object in ", {"type": "code", "text": ["/obj"]}, " to load the simulation files created by the HQueue clients back into Houdini."], "extent": [9595, 9731]}, {"blevel": 6, "type": "bullet", "indent": 4, "text": ["A ", {"type": "code", "text": ["DISTRIBUTE_", {"type": "var", "text": ["objectname"]}, "_CONTROLS"]}, " Null node in the DOP network."], "extent": [9731, 9811], "body": [{"type": "para", "indent": 8, "text": ["This node is mostly a placeholder for values. The render node explicitly sets values on the control ", {"type": "strong", "text": ["Null"]}, " DOP such as the tracker address/port and slice divisions, and then multiple distribution-aware DOPs in the network reference the value on the control ", {"type": "strong", "text": ["Null"]}, "."], "extent": [9811, 10085]}], "container": true}], "container": true}], "container": true}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["If you want to change the default path pattern for saved geometry files (", {"type": "code", "text": ["$HIP/geo/dist_${SLICE}_$F.bgeo.gz"]}, "), go to the Scene level (", {"type": "code", "text": ["/obj"]}, ") and double-click the ", {"type": "code", "text": ["distribute_", {"type": "var", "text": ["objectname"]}]}, " object to go inside. Select the ", {"type": "code", "text": ["loadslices"]}, " File node and change the ", {"type": "ui", "text": ["File"]}, " parameter. See ", {"scheme": null, "value": "/render/expressions", "type": "link", "text": ["using expressions in filenames"], "fullpath": "/render/expressions.html"}, " for more information."], "extent": [10085, 10448], "body": [{"type": "para", "indent": 4, "text": ["The path should be relative to ", {"type": "code", "text": ["$HIP"]}, "."], "extent": [10448, 10492]}], "container": true}], "container": true}]}, {"level": 3, "id": null, "container": true, "type": "h", "indent": 0, "text": ["How to view a simulation slice without running it on the farm"], "extent": [10492, 10562], "body": [{"type": "para", "indent": 0, "text": ["The ", {"scheme": "Icon", "value": "SHELF/distribute_fluid_sim", "type": "link", "text": "", "fullpath": "/dyno/SHELF/distribute_fluid_sim.html"}, " ", {"type": "ui", "text": ["Distribute"]}, " tool modifies the network to ready it for distribution. If you try to play back the simulation after these modifications, the network will only calculate a slice of the whole simulation, and several nodes will generate network traffic trying to talk to HQueue peers."], "extent": [10562, 10884]}, {"type": "para", "indent": 0, "text": ["If you want to check the simulation on a single machine, you can use parameters on the control ", {"type": "strong", "text": ["Null"]}, " DOP created by the ", {"type": "ui", "text": ["Distribute"]}, " tool to temporarily switch the network back to non-distributed operation."], "extent": [10884, 11095]}, {"type": "task_group", "body": [{"ext": null, "type": "task", "indent": 0, "text": ["View a slice without distributing the simulation"], "role": "item", "extent": [11095, 11151], "body": [{"type": "ord_group", "body": [{"blevel": 6, "type": "ord", "indent": 4, "text": ["On the ", {"type": "code", "text": ["DISTRIBUTE_uprespyro_CONTROLS"]}, " ", {"type": "strong", "text": ["Null"]}, " node in the DOP network, turn off the ", {"type": "ui", "text": ["Distribution"]}, " check-box."], "extent": [11151, 11278]}, {"blevel": 6, "type": "ord", "indent": 4, "text": ["Set the ", {"type": "ui", "text": ["Slice"]}, " parameter to the slice you want to view."], "extent": [11278, 11344]}], "container": true}], "container": true}], "container": true, "role": "item_group"}]}, {"level": 3, "id": null, "container": true, "type": "h", "indent": 0, "text": ["How to use particle fluid distribution with FLIP"], "extent": [11344, 11401], "body": [{"type": "para", "indent": 0, "text": ["Using particle distribution with tanks can sometimes lead to a loss of fluid. Turn on the ", {"type": "ui", "text": ["Distributed Pressure Solve"]}, " check-box on the ", {"scheme": "Node", "value": "/nodes/dop/flipsolver", "type": "link", "text": ["FLIP Solver"], "fullpath": "/nodes/dop/flipsolver.html"}, " to avoid this issue. This will account for pressure in the tank and result in smoother seams between slices. "], "extent": [11401, 11685]}, {"level": 4, "id": "narrowband", "container": true, "type": "h", "indent": 0, "text": ["How to set up a distributed narrow band FLIP tank"], "extent": [11685, 11758], "body": [{"type": "ord_group", "body": [{"blevel": 2, "type": "ord", "indent": 0, "text": ["Create a ", {"scheme": "Icon", "value": "SHELF/flat_tank", "type": "link", "text": "", "fullpath": "/dyno/SHELF/flat_tank.html"}, " FLIP tank using one of the tools on the ", {"type": "ui", "text": ["Oceans"]}, " shelf. ", {"type": "ui", "text": ["Narrow Band Particles"]}, " should be enabled by default."], "extent": [11758, 11908]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Use the ", {"scheme": "Icon", "value": "DOP/sliceplane", "type": "link", "text": "", "fullpath": "/dyno/DOP/sliceplane.html"}, {"scheme": null, "value": "/shelf/slice", "type": "link", "text": ["Slice"], "fullpath": "/shelf/slice.html"}, " tool on the ", {"type": "ui", "text": ["Particle Fluids"]}, " shelf to slice the particle fluid."], "extent": [11908, 12028]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Use the ", {"scheme": "Icon", "value": "SHELF/distribute_fluid_sim", "type": "link", "text": "", "fullpath": "/dyno/SHELF/distribute_fluid_sim.html"}, " ", {"type": "ui", "text": ["Distribute"]}, " tool, and choose ", {"type": "ui", "text": ["Slicing"]}, ". This will set up the network so that it can be solved in parallel on multiple machines using HQueue."], "extent": [12028, 12219]}], "container": true}, {"type": "para", "indent": 0, "text": [{"scheme": "Image", "value": "/images/fluid/distributed_nb.jpg", "type": "img", "text": ""}], "extent": [12219, 12261]}]}]}, {"level": 3, "id": "whitewater", "container": true, "type": "h", "indent": 0, "text": ["How to set up a distributed whitewater simulation"], "extent": [12261, 12332], "body": [{"type": "ord_group", "body": [{"blevel": 2, "type": "ord", "indent": 0, "text": ["Create a whitewater simulation using the tools on the ", {"type": "ui", "text": ["Oceans"]}, " shelf."], "extent": [12332, 12408]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Set the whitewater to distribute and click the ", {"scheme": "Icon", "value": "SHELF/distribute_fluid_sim", "type": "link", "text": "", "fullpath": "/dyno/SHELF/distribute_fluid_sim.html"}, " ", {"type": "ui", "text": ["Distribute Particle Fluid"]}, " tool on the  ", {"type": "ui", "text": ["Particle Fluids"]}, " shelf."], "extent": [12408, 12562]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Choose between ", {"type": "ui", "text": ["No Partitioning"]}, " and ", {"type": "ui", "text": ["Clustering"]}, " as the distribution method from the pop-up dialog box."], "extent": [12562, 12674], "body": [{"type": "note_group", "body": [{"type": "note", "indent": 8, "role": "item", "extent": [12674, 12688], "body": [{"type": "para", "indent": 12, "text": ["If the whitewater is pre-sliced using the ", {"scheme": null, "value": "/shelf/slice", "type": "link", "text": ["Slice"], "fullpath": "/shelf/slice.html"}, " or ", {"scheme": null, "value": "/shelf/slicealongline", "type": "link", "text": ["Slice Along Line"], "fullpath": "/shelf/slicealongline.html"}, " tools, there will also be an option to choose ", {"type": "ui", "text": ["Slicing"]}, "."], "extent": [12688, 12867]}], "container": true}], "container": true, "role": "item_group"}, {"type": "para", "indent": 8, "text": ["Selecting ", {"type": "ui", "text": ["No Partitioning"]}, " allows you to send your entire simulation to another machine. Selecting ", {"type": "ui", "text": ["Clustering"]}, " allows you to divide up your simulation into chunks that will be simulated simultaneously on another machine. Both options will create an ", {"scheme": "Node", "value": "/nodes/out/hq_sim", "type": "link", "text": ["HQueue Simulation"], "fullpath": "/nodes/out/hq_sim.html"}, " for your distributed simulation."], "extent": [12867, 13208]}], "container": true}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Choosing ", {"type": "ui", "text": ["Clustering"]}, " will set your ", {"type": "ui", "text": ["Partition Type"]}, " to ", {"type": "ui", "text": ["Clusters"]}, " on the ", {"scheme": "Node", "value": "/nodes/out/hq_sim", "type": "link", "text": ["HQueue Simulation"], "fullpath": "/nodes/out/hq_sim.html"}, " render node. Click the ", {"scheme": "Icon", "value": "BUTTONS/jump", "type": "link", "text": "", "fullpath": "/dyno/BUTTONS/jump.html"}, " ", {"type": "ui", "text": ["Jump to operator"]}, " button on ", {"type": "ui", "text": ["Cluster Node"]}, " parameter to jump to the ", {"type": "code", "text": ["partition_emission"]}, " Subnetwork. "], "extent": [13208, 13477]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Set your clusters using the ", {"type": "ui", "text": ["Divisions"]}, " parameter. "], "extent": [13477, 13534], "body": [{"type": "note_group", "body": [{"type": "note", "indent": 8, "role": "item", "extent": [13534, 13548], "body": [{"type": "para", "indent": 12, "text": ["You should make your particle fluid divisions parallel with the flow direction because these clusters will be simulated independently and don\u2019t transfer particles between frames that are born in separate clusters. "], "extent": [13548, 13776]}], "container": true}], "container": true, "role": "item_group"}, {"type": "para", "indent": 8, "text": ["In the following example, a ", {"scheme": null, "value": "/shelf/beachtank", "type": "link", "text": ["Beach Tank"], "fullpath": "/shelf/beachtank.html"}, " is divided along the Z-axis, which coincides with the flow of the waves up the beach."], "extent": [13776, 13929]}, {"type": "para", "indent": 8, "text": [{"scheme": "Image", "value": "/images/dynamics/distribute_cluster.jpg", "type": "img", "text": ""}], "extent": [13929, 13986]}], "container": true}], "container": true}]}]}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Set up distributed clustered smoke and pyro simulations"], "extent": [13986, 14048], "body": [{"type": "ord_group", "body": [{"blevel": 2, "type": "ord", "indent": 0, "text": ["Create a clustered smoke or pyro simulation from point sources using the ", {"type": "ui", "text": ["Smoke Cluster"]}, " or ", {"type": "ui", "text": ["Pyro Cluster"]}, " tools on the ", {"type": "ui", "text": ["Pyro FX"]}, " shelf tab (see ", {"scheme": null, "value": "/pyro/clustering", "type": "link", "text": ["clustering"], "fullpath": "/pyro/clustering.html"}, ")."], "extent": [14048, 14235]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["On the ", {"type": "ui", "text": ["Container Tools"]}, " shelf tab, click the ", {"scheme": "Icon", "value": "SHELF/distribute_fluid_sim", "type": "link", "text": "", "fullpath": "/dyno/SHELF/distribute_fluid_sim.html"}, " ", {"type": "ui", "text": ["Distribute"]}, " tool."], "extent": [14235, 14341]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["Select the container you want to distribute and press ", {"keys": ["Enter"], "type": "keys", "text": null}, "."], "extent": [14341, 14409], "body": [{"type": "para", "indent": 4, "text": ["If you are distributing a clustered simulation with multiple containers created by the smoke/pyro cluster tool, you can just select one of them."], "extent": [14409, 14563]}, {"type": "para", "indent": 4, "text": ["(Alternatively you can select the DOP object in the network editor and then press ", {"keys": ["Enter"], "type": "keys", "text": null}, " in the viewport.)"], "extent": [14563, 14678]}], "container": true}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["If the object has multiple containers (for example, it was created using ", {"scheme": null, "value": "/pyro/clustering", "type": "link", "text": ["clustering"], "fullpath": "/pyro/clustering.html"}, "), a dialog box appears asking if you want to distribute the simulation using ", {"type": "em", "text": ["slices"]}, " or ", {"type": "em", "text": ["clustering"]}, "."], "extent": [14678, 14887], "body": [{"type": "para", "indent": 4, "text": ["(If your simulation is so massive even a single clustered container at a time is too much to run on one machine, you can click ", {"type": "ui", "text": ["Slicing"]}, " to distribute separate slices of each clustered container.)"], "extent": [14887, 15091]}], "container": true}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["If for some reason you have more than one object importing the results of the simulation, a dialog box will ask you which object should be set up for distribution (see ", {"scheme": null, "value": "#clustering_guts", "type": "link", "text": ["how the tool modifies the geometry network"], "fullpath": "/dyno/distribute.html#clustering_guts", "fragment": "#clustering_guts"}, " below)."], "extent": [15091, 15332]}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["The tool will create and select a ", {"scheme": "Node", "value": "/nodes/out/hq_sim", "type": "link", "text": ["HQueue simulation render node"], "fullpath": "/nodes/out/hq_sim.html"}, ". Set the node\u2019s ", {"type": "ui", "text": ["HQueue server"]}, " parameter to the name of the HQueue server machine and port name (for example ", {"type": "code", "text": ["hq.company.com:5000"]}, ")."], "extent": [15332, 15553], "body": [{"type": "para", "indent": 4, "text": ["If you are slicing, you can set the ", {"type": "ui", "text": ["Slice Divisions"]}, " parameter. The default ", {"type": "code", "text": ["1, 1, 1"]}, " slices does not actually divide the container into multiple subdomains. Increasing these values to ", {"type": "code", "text": ["2, 2, 2"]}, ", for example, will slice the container into 8 smaller boxes for distribution."], "extent": [15553, 15834]}], "container": true}], "container": true}, {"level": 3, "id": "clustering_guts", "container": true, "type": "h", "indent": 0, "text": ["Distributed clustering behind-the-scenes"], "extent": [15834, 15901], "body": [{"type": "para", "indent": 0, "text": ["In the Geometry object that imports the simulated fields you distributed (for example, ", {"type": "code", "text": ["import_pyro_build"]}, "), the ", {"type": "ui", "text": ["Distribute"]}, " tool adds a ", {"scheme": "Node", "value": "/nodes/sop/dopio", "type": "link", "text": ["DOP I/O node"], "fullpath": "/nodes/sop/dopio.html"}, " to write the generated cluster fields to disk using a ", {"scheme": "Node", "value": "/nodes/out/geometry", "type": "link", "text": ["ROP Output Driver"], "fullpath": "/nodes/out/geometry.html"}, " on the farm."], "extent": [15901, 16178]}, {"type": "para", "indent": 0, "text": ["When the HIP file is ", {"scheme": null, "value": "#run", "type": "link", "text": ["run on the farm"], "fullpath": "/dyno/distribute.html#run", "fragment": "#run"}, " (below), the HQueue render node does the following:"], "extent": [16178, 16275]}, {"type": "bullet_group", "body": [{"blevel": 2, "type": "bullet", "indent": 0, "text": ["Sets the global ", {"type": "code", "text": ["$CLUSTER"]}, " variable to the cluster number being generated on this machine."], "extent": [16275, 16369]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["On the ", {"type": "strong", "text": ["Cluster Points"]}, " node (pointed to in the HQueue render node\u2019s ", {"type": "ui", "text": ["Cluster Node"]}, " parameter), it sets the  ", {"type": "ui", "text": ["Cluster Filter"]}, " parameter to the ", {"type": "code", "text": ["$CLUSTER"]}, " variable, so the source network will only generate source points for that cluster number."], "extent": [16369, 16620]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["It cooks the ROP Output Driver (pointed to in the HQueue render node\u2019s ", {"type": "ui", "text": ["Output Driver"]}, " parameter) which causes the simulation to cook and writes out the geometry for the current cluster and frame."], "extent": [16620, 16822]}], "container": true}, {"type": "para", "indent": 0, "text": ["The ", {"type": "ui", "text": ["Distribute"]}, " tool also creates a ", {"scheme": "Node", "value": "/nodes/sop/filemerge", "type": "link", "text": ["File Merge node"], "fullpath": "/nodes/sop/filemerge.html"}, " in the network to import the cluster fields generated on the farm and reintegrate them on your machine. It sets the display and render flags on this node so when you view the HIP file on your machine it uses the cached geometry files."], "extent": [16822, 17134]}, {"type": "note_group", "body": [{"type": "note", "indent": 0, "role": "item", "extent": [17134, 17140], "body": [{"type": "para", "indent": 4, "text": ["The filename pattern for the output geometry files is set on the File Merge node and referenced from the ROP Output Driver, so if you want to change it, change it on the File Merge node. The pattern must incorporate the ", {"type": "code", "text": ["$CLUSTER"]}, " (cluster number being simulated) and ", {"type": "code", "text": ["$F"]}, " (current frame) variables."], "extent": [17140, 17445]}], "container": true}], "container": true, "role": "item_group"}]}]}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Turn off the live simulation"], "extent": [17445, 17480], "body": [{"type": "para", "indent": 0, "text": ["Once the HQueue network has generated the geometry, you should stop the original simulation network from cooking since you now have the end-result cached."], "extent": [17480, 17637]}, {"type": "para", "indent": 0, "text": ["Do one of the following:"], "extent": [17637, 17663]}, {"type": "bullet_group", "body": [{"blevel": 2, "type": "bullet", "indent": 0, "text": ["Turn off the visibility of any scene-level objects that require the simulation to cook."], "extent": [17663, 17754]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["Turn off simulation in Houdini: right click (or pressing and holding on) the ", {"scheme": "Icon", "value": "BUTTONS/resimulate", "type": "link", "text": "", "fullpath": "/dyno/BUTTONS/resimulate.html"}, " simulation menu in the bottom right corner of the main window and turn off ", {"type": "ui", "text": ["Enable simulation"]}, "."], "extent": [17754, 17958]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": ["Start a fresh new ", {"type": "code", "text": [".hip"]}, " file that simply loads the generated particle fluid geometry files using a ", {"scheme": "Node", "value": "/nodes/sop/file", "type": "link", "text": ["File surface node"], "fullpath": "/nodes/sop/file.html"}, "."], "extent": [17958, 18096]}], "container": true}]}, {"level": 2, "id": "run", "container": true, "type": "h", "indent": 0, "text": ["Run the distributed simulation on the farm"], "extent": [18096, 18151], "body": [{"type": "ord_group", "body": [{"blevel": 2, "type": "ord", "indent": 0, "text": ["In the main menu, choose ", {"type": "ui", "text": ["Render \u25b8 Edit render node \u25b8 distributedsim"]}, ". In the parameter editor:"], "extent": [18151, 18253], "body": [{"type": "bullet_group", "body": [{"blevel": 6, "type": "bullet", "indent": 4, "text": ["Set the frame range you want to simulate."], "extent": [18253, 18306]}, {"blevel": 6, "type": "bullet", "indent": 4, "text": ["Check the ", {"type": "ui", "text": ["Slice divisions"]}, " parameter. The product of the three components should equal the number of regions in your particle fluid simulation (for example, ", {"type": "code", "text": ["3, 1, 1"]}, " for a simulation with 3 regions)."], "extent": [18306, 18521], "body": [{"type": "para", "indent": 8, "text": ["This number is set automatically when the ", {"type": "ui", "text": ["Distribute"]}, " tool creates the render node. However, if you then go back and change the number of slices (for example, by changing the ", {"type": "ui", "text": ["Number of regions"]}, " parameter on a Slice Along Line node), you need to update this parameter on the render node."], "extent": [18521, 18827]}], "container": true}, {"blevel": 6, "type": "bullet", "indent": 4, "text": ["Set the ", {"type": "ui", "text": ["HQ Server"]}, " to the hostname and port of the HQueue server, for example ", {"type": "code", "text": ["render.example.com:5000"]}, "."], "extent": [18827, 18946]}], "container": true}], "container": true}, {"blevel": 2, "type": "ord", "indent": 0, "text": ["In the parameter editor, click ", {"type": "ui", "text": ["Render"]}, " to send the job to HQueue."], "extent": [18946, 19018], "body": [{"type": "para", "indent": 4, "text": ["The render node sends its information to the HQueue server. The HQueue server sends commands to its client machines to load the ", {"type": "code", "text": [".hip"]}, " file and simulate and save a slice of the particle fluid simulation per-frame. The individual client machines save their generated geometry cache files to the shared network directory."], "extent": [19018, 19348]}], "container": true}], "container": true}]}], "title": ["Distributing simulations"], "summary": ["Distribute shelf tools set up an object\u2019s sim network so it can be solved in parallel on a farm of multiple machines using HQueue."]}