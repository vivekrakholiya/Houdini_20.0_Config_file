{"type": "root", "attrs": {"type": "node", "context": "sop", "internal": "agentterrainadaptation", "icon": "CROWDS/agentterrainadaptation", "since": "15.5", "version": null, "namespace": null}, "body": [{"level": 0, "type": "title", "indent": 0, "text": ["Agent Terrain Adaptation"], "extent": [111, 140]}, {"type": "summary", "indent": 0, "text": ["Adapts agents' legs to conform to terrain and prevent the feet from sliding."], "extent": [140, 225]}, {"type": "para", "indent": 0, "text": ["This node is used to modify the transforms of agents' leg bones to avoid intersection with terrain and prevent the feet from sliding.\nTerrain adaptation may also be done during a ", {"scheme": "Node", "value": "/nodes/dop/agentterrainadaptation", "type": "link", "text": ["crowd simulation"], "fullpath": "/nodes/dop/agentterrainadaptation.html"}, ", but this SOP can be used, for example, to adapt a cached crowd simulation to new terrain."], "extent": [225, 547]}, {"level": 1, "id": "parameters", "container": true, "type": "parameters_section", "indent": 0, "role": "section", "extent": [547, 559], "body": [{"type": "parameters_item_group", "body": [{"type": "parameters_item", "indent": 0, "text": ["Group"], "extent": [559, 567], "body": [{"type": "para", "indent": 4, "text": ["Specifies a group of agents that this node should affect."], "extent": [567, 630]}], "container": true, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Terrain Group"], "extent": [1501, 1516], "body": [{"type": "para", "indent": 4, "text": ["The primitives in the terrain geometry to be used for ray intersections."], "extent": [1538, 1616]}], "container": true, "attrs": {"id": "terraingroup"}, "role": "item"}], "container": true, "role": "item_group"}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Terrain"], "extent": [688, 702], "body": [{"type": "parameters_item_group", "body": [{"type": "parameters_item", "indent": 0, "text": ["Enable Simulation"], "extent": [702, 722], "body": [{"type": "para", "indent": 4, "text": ["Some optional features (such as foot locking and leaning) require access to the state of the agents on the previous frame.\n    As a result, an embedded DOP network is used to implement the terrain adaptation.\n    If this parameter is disabled, those features will also be disabled and the SOP will not require simulation.\n    This can be useful for quickly producing a rough preview of the final terrain adaptation results."], "extent": [722, 1151]}], "container": true, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Enable Foot Locking"], "extent": [810, 832], "body": [{"type": "para", "indent": 4, "text": ["When turned on, prevents the ankle and toe from sliding when the foot should be planted.\n    The channels specified on the ", {"scheme": "Node", "value": "/nodes/sop/agentprep", "type": "link", "text": ["Agent Prep SOP"], "fullpath": "/nodes/sop/agentprep.html"}, " are used to determine when the foot should be planted during the animation clip, as well as how to blend out of the locked position.\n    This option also improves terrain adaptation for situations where the unadjusted foot position is above the terrain, since the solver can distinguish between when the foot should be planted and when the foot is actually supposed to be above the ground.\n    This option may still be used if no terrain object is specified."], "extent": [859, 1482]}, {"type": "para", "indent": 4, "text": ["The optional ", {"type": "code", "text": ["agentterrainadaptation_footdown"]}, " float array point attribute can be used to override the foot down values computed from the agent\u2019s animation clips.\n    The attribute is expected to contain a replacement foot down value for each entry in the ", {"type": "code", "text": ["agentrig_footchannels"]}, " point attribute.\n    This may be useful when applying terrain adaptation to cached agents."], "extent": [1482, 1858]}], "container": true, "attrs": {"id": "enablefootlocking"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Adjust Hips"], "extent": [1858, 1871], "body": [{"type": "para", "indent": 4, "text": ["When turned on, adjusts the position of the hips to ensure that the legs are not over-stretched when planting the feet on uneven terrain."], "extent": [1891, 2034]}], "container": true, "attrs": {"id": "adjusthips"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Hip Offset"], "extent": [2034, 2046], "body": [{"type": "para", "indent": 4, "text": ["Specifies an additional offset to shift the hips up or down."], "extent": [2065, 2131]}], "container": true, "attrs": {"id": "hipoffset"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Hip Shift Per Frame"], "extent": [2131, 2152], "body": [{"type": "para", "indent": 4, "text": ["When turned on, specifies how much the hips can be shifted by in a single frame. This can reduce sudden hip motion on uneven terrain."], "extent": [2178, 2317]}], "container": true, "attrs": {"id": "hipshiftperframe"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Knee Damping Threshold (%)"], "extent": [2317, 2345], "body": [{"type": "para", "indent": 4, "text": ["When the distance from the upper leg to the target ankle position is greater than this percentage of the maximum leg length, the knee angle will be damped so that it smoothly approaches a 180 degree angle as the target ankle position is extended.\n    This can prevent the knee from popping when the leg is almost fully extended."], "extent": [2375, 2709]}, {"type": "note_group", "body": [{"type": "note", "indent": 4, "role": "item", "extent": [2709, 2719], "body": [{"type": "para", "indent": 8, "text": ["This can allow the leg to stretch slightly, as keeping the foot planted on the terrain is a higher priority."], "extent": [2719, 2837]}], "container": true}], "container": true, "role": "item_group"}], "container": true, "attrs": {"id": "kneedampingthreshold"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Enable Terrain Projection"], "extent": [8155, 8182], "body": [{"type": "para", "indent": 4, "text": ["When turned on, projects the agent particles on the given terrain."], "extent": [8215, 8287]}], "container": true, "attrs": {"id": "enableterrainprojection"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Mode"], "extent": [1616, 1622], "body": [{"type": "para", "indent": 4, "text": ["Controls the direction of the terrain projection."], "extent": [1636, 1691]}, {"type": "dt_group", "body": [{"type": "dt", "indent": 4, "text": ["Direction Vector"], "extent": [1691, 1713], "body": [{"type": "para", "indent": 8, "text": ["Use the direction specified in ", {"type": "ui", "text": ["Direction"]}, "."], "extent": [1713, 1768]}], "container": true}, {"type": "dt", "indent": 4, "text": ["Up Attribute"], "extent": [1768, 1786], "body": [{"type": "para", "indent": 8, "text": ["Use the agent\u2019s ", {"type": "code", "text": ["up"]}, " attribute."], "extent": [1786, 1827]}], "container": true}], "container": true}], "container": true, "attrs": {"id": "mode"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Offset"], "extent": [2564, 2572], "body": [{"type": "para", "indent": 4, "text": ["Additional offset that will shift all the agents up or down."], "extent": [2588, 2654]}], "container": true, "attrs": {"id": "offset"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Enable Terrain Adaptation"], "extent": [2837, 2864], "body": [{"type": "para", "indent": 4, "text": ["When turned on, adjusts the agents' legs to conform to the terrain."], "extent": [2897, 2970]}], "container": true, "attrs": {"id": "enableterrainadaptation"}, "role": "item"}], "container": true, "role": "item_group"}, {"type": "include_group", "body": [{"ext": "/nodes/dop/agentterrainadaptation#enableleaning", "type": "include", "indent": 0, "role": "item", "extent": [1682, 1741]}], "container": true, "role": "item_group"}, {"type": "parameters_item_group", "body": [{"type": "parameters_item", "indent": 0, "text": ["Lean Angle Per Frame"], "extent": [2970, 2992], "body": [{"type": "para", "indent": 4, "text": ["When navigating uneven terrain, the agent can lean forward or backward. When turned on, this parameter specifies the maximum angle (in degrees) that the agent can tilt in a single frame."], "extent": [3011, 3203]}], "container": true, "attrs": {"id": "leanangle"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Backward Lean"], "extent": [3203, 3218], "body": [{"type": "para", "indent": 4, "text": ["Specifies how far (in degrees) the agent can lean backward."], "extent": [3240, 3305]}], "container": true, "attrs": {"id": "backwardlean"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Forward Lean"], "extent": [3305, 3319], "body": [{"type": "para", "indent": 4, "text": ["Specifies how far (in degrees) the agent can lean forward."], "extent": [3340, 3404]}], "container": true, "attrs": {"id": "forwardlean"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Set Up Vector to Terrain Normal"], "extent": [1911, 1944], "body": [{"type": "para", "indent": 4, "text": ["Updates the up vector to match the terrain normal. This requires that ", {"type": "ui", "text": ["Enable Terrain Projection"]}, " is enabled.\n    This may be useful for situations such as insects crawling on walls."], "extent": [1944, 2134]}], "container": true, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Reference Direction"], "extent": [4363, 4384], "body": [{"type": "para", "indent": 4, "text": ["The agent\u2019s axis, aligned to follow the velocity vector. For example, setting this to ", {"type": "code", "text": ["1,0,0"]}, " will align the agent\u2019s X-axis with its velocity."], "extent": [4400, 4548]}], "container": true, "attrs": {"id": "refdir"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Reference Up"], "extent": [4548, 4562], "body": [{"type": "para", "indent": 4, "text": ["The original up vector of the agent. This parameter is used with ", {"type": "ui", "text": ["Reference Direction"]}, " when updating the agent\u2019s orientation."], "extent": [4577, 4710]}], "container": true, "attrs": {"id": "refup"}, "role": "item"}], "container": true, "role": "item_group"}]}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Guides"], "extent": [2215, 2228], "body": [{"type": "parameters_item_group", "body": [{"type": "parameters_item", "indent": 0, "text": ["Show Guide Geometry"], "extent": [3722, 3744], "body": [{"type": "para", "indent": 4, "text": ["When turned on, displays guide geometry indicating the positions of the lower limb joints and whether the feet are locked."], "extent": [3763, 3891]}], "container": true, "attrs": {"id": "showguide"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Scale"], "extent": [3891, 3898], "body": [{"type": "para", "indent": 4, "text": ["Adjusts the size of the guide geometry."], "extent": [3918, 3963]}], "container": true, "attrs": {"id": "guidescale"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Locked Scale"], "extent": [3963, 3977], "body": [{"type": "para", "indent": 4, "text": ["Adjusts the ", {"type": "ui", "text": ["Scale"]}, " to indicate when the foot is locked."], "extent": [3998, 4062]}], "container": true, "attrs": {"id": "lockedscale"}, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Color"], "extent": [4062, 4069], "body": [{"type": "para", "indent": 4, "text": ["Specifies the color of the guide geometry.\n    When ", {"type": "ui", "text": ["Enable Foot Locking"]}, " is turned on, the color ramp indicates when the ankle and toe joints are locked or blending out of the locked position."], "extent": [4089, 4290]}], "container": true, "attrs": {"id": "guidecolor"}, "role": "item"}], "container": true, "role": "item_group"}]}, {"level": 2, "id": null, "container": true, "type": "h", "indent": 0, "text": ["Simulation"], "extent": [2453, 2470], "body": [{"type": "parameters_item_group", "body": [{"type": "parameters_item", "indent": 0, "text": ["Reset Simulation"], "extent": [16, 34], "body": [{"type": "para", "indent": 4, "text": ["Clears the entire simulation cache."], "extent": [34, 75]}], "container": true, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Sub Steps"], "extent": [75, 86], "body": [{"type": "para", "indent": 4, "text": ["Specifies the number of substeps the DOP simulation should perform each frame."], "extent": [86, 170]}], "container": true, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Start Frame"], "extent": [170, 183], "body": [{"type": "para", "indent": 4, "text": ["Specifies the frame at which the simulation will start cooking."], "extent": [183, 252]}], "container": true, "role": "item"}, {"type": "parameters_item", "indent": 0, "text": ["Scale Time"], "extent": [252, 264], "body": [{"type": "para", "indent": 4, "text": ["Specifies a scale factor that relates global time to the simulation time for the DOP network."], "extent": [264, 362]}], "container": true, "role": "item"}], "container": true}]}], "text": "Parameters"}, {"level": 1, "id": "inputs", "container": true, "type": "inputs_section", "indent": 0, "role": "section", "extent": [2506, 2514], "body": [{"type": "dt_group", "body": [{"type": "dt", "indent": 4, "text": ["Agents"], "extent": [2514, 2526], "body": [{"type": "para", "indent": 8, "text": ["Agent primitives."], "extent": [2526, 2552]}], "container": true}, {"type": "dt", "indent": 4, "text": ["Terrain"], "extent": [2552, 2565], "body": [{"type": "para", "indent": 8, "text": ["Terrain geometry."], "extent": [2565, 2592]}], "container": true}], "container": true}], "text": "Inputs"}, {"level": 1, "id": "related", "container": true, "type": "related_section", "indent": 0, "role": "section", "extent": [2592, 2601], "body": [{"type": "bullet_group", "body": [{"blevel": 2, "type": "bullet", "indent": 0, "text": [{"scheme": "Node", "value": "/nodes/sop/agent", "type": "link", "text": "", "fullpath": "/nodes/sop/agent.html"}], "extent": [2601, 2620]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": [{"scheme": "Node", "value": "/nodes/sop/agentprep", "type": "link", "text": "", "fullpath": "/nodes/sop/agentprep.html"}], "extent": [2620, 2643]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": [{"scheme": "Node", "value": "/nodes/dop/agentterrainadaptation", "type": "link", "text": "", "fullpath": "/nodes/dop/agentterrainadaptation.html"}], "extent": [2643, 2679]}, {"blevel": 2, "type": "bullet", "indent": 0, "text": [{"scheme": "Node", "value": "/nodes/dop/agentterrainprojection", "type": "link", "text": "", "fullpath": "/nodes/dop/agentterrainprojection.html"}], "extent": [2679, 2715]}], "container": true}], "text": "Related"}], "title": ["Agent Terrain Adaptation"], "summary": ["Adapts agents' legs to conform to terrain and prevent the feet from sliding."], "included": ["/nodes/dop/agentlookatapply", "/nodes/dop/agentlookatapply-", "/nodes/dop/agentlookatapply-2.0", "/nodes/dop/agentterrainadaptation", "/nodes/dop/agentterrainprojection", "/nodes/dop/crowd_steer_parms", "/nodes/dop/crowdsolver", "/nodes/dop/gassubstep", "/nodes/dop/popsolver", "/nodes/dop/popsteeravoid", "/nodes/dop/standard_data_locals", "/nodes/dop/standard_data_outputs", "/nodes/dop/standard_datagroup_parms", "/nodes/dop/standard_dataname_parms", "/nodes/dop/standard_dataop_parms", "/nodes/dop/standard_distribution", "/nodes/dop/standard_locals", "/nodes/dop/standard_microsolver_inputs", "/nodes/dop/standard_pop_parms", "/nodes/dop/standard_solver_mutualparms", "/nodes/dop/standard_solver_parms", "/nodes/sop/standard_crowdsim_parms"]}